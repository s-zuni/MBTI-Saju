<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MBTI × 사주 즉시 분석</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif; background:#0b0c10; color:#e8eaed; margin:0; }
    .wrap { max-width: 880px; margin: 40px auto; padding: 24px; background:#12141a; border-radius:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35);}
    h1 { margin-top:0; }
    label { display:block; margin: 12px 0 6px; }
    input, select { width:100%; padding:12px; border-radius:10px; border:1px solid #2b2f3a; background:#0f1117; color:#e8eaed; }
    button { margin-top:16px; padding:12px 16px; border:0; border-radius:10px; background:#4f46e5; color:#fff; font-weight:600; cursor:pointer; }
    button[disabled] { opacity:.6; cursor:not-allowed; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; margin-top:20px;}
    .card { padding:16px; border:1px solid #2b2f3a; border-radius:12px; background:#151823; }
    .muted { color:#9aa0a6; font-size:14px; }
    .chips { margin-top:8px;}
    .chip { display:inline-block; padding:6px 10px; border:1px solid #2b2f3a; border-radius:999px; font-size:12px; margin-right:8px;}
    #error { color:#ff6b6b; margin-top:12px; display:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>MBTI × 사주 즉시 분석</h1>
    <p class="muted">정보를 입력하면 서버에서 안전하게 분석하여 바로 결과를 보여드려요.</p>

    <form id="form">
      <label>이름</label>
      <input name="name" required />

      <label>성별</label>
      <select name="gender" required>
        <option value="">선택</option>
        <option>여성</option>
        <option>남성</option>
        <option>기타</option>
      </select>

      <label>생년월일</label>
      <input type="date" name="birth_date" required />

      <label>출생시간</label>
      <input type="time" name="birth_time" required />

      <label>MBTI</label>
      <select name="mbti" required>
        <option value="">선택</option>
        <option>INTJ</option><option>INTP</option><option>ENTJ</option><option>ENTP</option>
        <option>INFJ</option><option>INFP</option><option>ENFJ</option><option>ENFP</option>
        <option>ISTJ</option><option>ISFJ</option><option>ESTJ</option><option>ESFJ</option>
        <option>ISTP</option><option>ISFP</option><option>ESTP</option><option>ESFP</option>
      </select>

      <button id="submitBtn" type="submit">분석 시작</button>
      <div id="error"></div>
    </form>

    <div id="resultBox" style="display:none;">
      <h2 id="title"></h2>
      <div class="chips">
        <span class="chip" id="chipMbti"></span>
        <span class="chip" id="chipGender"></span>
        <span class="chip" id="chipBirth"></span>
      </div>

      <div class="grid">
  <div class="card"><h3>MBTI</h3><div id="mbti"></div></div>
  <div class="card"><h3>사주</h3><div id="saju"></div></div>
  <div class="card"><h3>공통 성향</h3><div id="trait"></div></div>
  <div class="card"><h3>추천 직업</h3><div id="jobs"></div></div>
  <div class="card"><h3>추천 궁합</h3><div id="match"></div></div>
</div>
    </div>
  </div>

<script>
  const $ = s => document.querySelector(s);
  const form = $('#form');
  const btn = $('#submitBtn');
  const errorBox = $('#error');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorBox.style.display = 'none';
    btn.disabled = true; btn.textContent = '분석 중…';

    const payload = {
      name: form.name.value.trim(),
      gender: form.gender.value,
      birth_date: form.birth_date.value,
      birth_time: form.birth_time.value,
      mbti: form.mbti.value.toUpperCase()
    };

    try {
      const r = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!r.ok) throw new Error('서버 오류');
      const data = await r.json();

      // 헤더(그대로 유지)
      $('#title').textContent = `${payload.name}님의 결과`;
      $('#chipMbti').textContent = payload.mbti;
      $('#chipGender').textContent = payload.gender;
      $('#chipBirth').textContent = `${payload.birth_date} · ${payload.birth_time}`;

      // 본문(새 키 반영)
      const nl2br = (t) => (t || '').toString().replace(/\n/g,'<br>');
      $('#mbti').innerHTML  = nl2br(data.mbti)  || '—';
      $('#saju').innerHTML  = nl2br(data.saju)  || '—';
      $('#trait').innerHTML = nl2br(data.trait) || '—';
      $('#jobs').innerHTML  = nl2br(data.jobs)  || '—';
      $('#match').innerHTML = nl2br(data.match) || '—';

      $('#resultBox').style.display = 'block';
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    } catch (err) {
      errorBox.textContent = '분석에 실패했습니다. 잠시 후 다시 시도해주세요.';
      errorBox.style.display = 'block';
    } finally {
      btn.disabled = false; btn.textContent = '분석 시작';
    }
  });
</script>
</body>
</html>
